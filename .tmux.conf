### --- Prefix Key ---
# Remap prefix from 'C-b' to 'C-a'
unbind C-b
set -g prefix C-a
bind C-a send-prefix

### --- Split Panes ---
unbind '"'
unbind %
bind v split-window -h
bind - split-window -v

### --- Pane Navigation (Smart Vim/Tmux integration) ---
# Detect if current pane is running Vim or Neovim
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"

# Move between panes or send movement keys to Vim
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# Allow same navigation in copy-mode
bind -T copy-mode-vi C-h select-pane -L
bind -T copy-mode-vi C-j select-pane -D
bind -T copy-mode-vi C-k select-pane -U
bind -T copy-mode-vi C-l select-pane -R

### --- Resize Panes with Prefix + Ctrl + hjkl ---
bind -r -T prefix C-h resize-pane -L 5
bind -r -T prefix C-j resize-pane -D 5
bind -r -T prefix C-k resize-pane -U 5
bind -r -T prefix C-l resize-pane -R 5

### --- Status Bar & Appearance ---
set -g status-bg black
set -g status-fg white
set -g status-left-length 40
set -g status-right-length 120
set -g status-interval 2

set -g status-left '#[fg=green]#H #[fg=cyan]|'
set -g status-right '#[fg=yellow]%Y-%m-%d #[fg=cyan]%H:%M'

### --- Mouse & Clipboard ---
set -g mouse on
set-option -s set-clipboard on

### --- Quality of Life Tweaks ---
# Enable 256 color support
set -g default-terminal "screen-256color"

# Allow fast pane switching
set-option -g repeat-time 150

# Use vi-style key bindings in copy mode
set-window-option -g mode-keys vi

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Allow reloading tmux config quickly
bind r source-file ~/.tmux.conf \; display-message "Tmux config reloaded!"

# Allow easy detach
bind d detach

### --- Optional: Keep the tmux version logic (for C-\ on old versions) ---
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

